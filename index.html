<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta content="black" name="apple-mobile-web-app-status-bar-style">
  <meta name="description" content="Web site created using create-react-app" />
  <!-- <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

  <meta HTTP-EQUIV="pragma" CONTENT="no-cache">
  <meta HTTP-EQUIV="Cache-Control" CONTENT="no-store, must-revalidate">
  <meta HTTP-EQUIV="expires" CONTENT="Wed, 26 Feb 1997 08:21:57 GMT">
  <meta HTTP-EQUIV="expires" CONTENT="0"> -->

  <title>来点亮您的校友地图！</title>

  <link type="text/css" rel="styleSheet" href="css/style.css" />
  <link rel="stylesheet" href="css/weui.min.css">
  <link rel="stylesheet" href="css/jquery-weui.css">
  <style>
    .weibo .peoIt-name {
      font-size: .32rem;
      line-height: inherit;
    }

    .weibo .peoIt-avatar {
      width: 1rem;
      height: 1rem;
      margin: .1rem auto;
      background-color: white;
      box-shadow: 0 0 0.2rem #55bdf9;
      border-radius: .1rem;
    }

    .weibo .peoIt-s1 {
      padding-left: .4rem;
      font-size: .64rem;
      font-weight: bold;
      text-shadow: 0 0 0.2rem #55bdf9;
      line-height: inherit;
    }

    .weibo .peoIt-s2 {
      font-size: .37rem;
      text-shadow: 0 0 0.2rem #55bdf9;
      line-height: inherit;
    }

    .weibo .peoIt-s3 {
      font-size: .4rem;
      font-weight: bold;
      text-shadow: 0 0 0.2rem #55bdf9;
      line-height: inherit;
    }

    .weibo .peoIt-three,
    .weibo .peoIt-two {
      font-size: .34rem;
      line-height: inherit;
    }

    .weibo .peoI-btn {
      position: absolute;
      top: 118vw;
      left: 50%;
      bottom: 47vw;
      width: 68%;
      transform: translateX(-50%);
    }
  </style>
  <!--   <script>
    var _hmt = _hmt || [];
    (function () {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?7061cf73876cf30e2a6e0d601eb47df9";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script> -->
  <script>
    var utils = {
      isWeixin: function () {
        var ua = window.navigator.userAgent.toLowerCase();
        return ua.match(/MicroMessenger/i) == 'micromessenger';
      },
      getQueryString: function (name) {
        var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return decodeURIComponent(r[2]);
        return null;
      },
      downloadImage: function (src) {
        return new Promise(function (resolve) {
          var image = new Image();
          image.crossOrigin = '*';
          image.src = src;
          image.onload = function () {
            resolve(this);
          }
        });
      },
      createPoster: function (element, width, height) {
        return new Promise(function (resolve) {
          html2canvas(element, {
            useCORS: true,
            width,
            height,
            backgroundColor: null
          }).then(canvas => {
            resolve(canvas.toDataURL());
          });
        });
      }
    }
  </script>
</head>

<body>

  <div class="loading-con">
    <div class="loaC-nr">
      <div><img class="imgW100" src="img/topImg.png" /></div>
      <div class="locaCN-logo"><img class="imgW100" src="img/logo2.png" /></div>
      <div id="progressBox">
        <div id="progressBar"></div>
      </div>
      <div id="progressText">0%</div>

      <img class="loaCN-logo" src="img/text03.png" />
    </div>
  </div>

  <div class="main" style="display: none">
    <div id="musicBgStatus" class="bgIcon"></div>
    <!--<audio id="audioBg" src="audio/bg.mp3" loop></audio>-->
    <audio id="audioBg" src="" loop></audio>
    <audio id="audioClick" src="audio/click.mp3"></audio>
    <audio id="audioFly" src="audio/fly.mp3"></audio>

    <div class="con-bg"><img src="img/bg.png" /></div>

    <div class="star-bgs" style="display: none">
      <img class="imgW100" src="img/star-bg.gif" />
    </div>
    <div class="world-icon"><img class="imgW100" src="img/icon01.gif" /></div>
    <div class="world-bg"><img class="imgW100" src="img/icon-bg.png" /></div>

    <div class="world-info">
      <div class="wi-title">
        <img class="imgW100" src="img/info-bg1.png" />
        <span><img class="imgW100" src="img/text01.gif" /></span>
      </div>
      <div class="wi-city">
        <ul id='city-picker' class="city-menu flex-con">
          <li>省份</li>
          <li>城市</li>
          <li>区县</li>
        </ul>

        <div id="picker-container"></div>

        <div class="city-btn">
          <img class="cancelS" src='img/clickBtns.png' />
        </div>
      </div>

      <div><img class="imgW100" src="img/info-bg2.png" /></div>

      <div class="wi-more"></div>


      <div class="wi-text">
        <img class="wiT-logo fadeInUp" src="img/logo2.png" />
        <div class="wiT-nr fadeInUp"><img class="imgW100" src='img/text02.png' /></div>
      </div>

    </div>


    <div class="gray-start touchWay" style="display: none">
      <div class="gS-start"><img src="img/start01.png" /></div>
      <div class="gS-start-one"><img class="imgW100" src="img/text04.png" /></div>
    </div>

    <div class="animate-one" style="display: none"><img class="imgW100" src="img/animate001.gif" /></div>
    <div class="animate-two" style="display: none"><img class="imgW100" /></div>

    <div class="people-info weibo" style="display: none">
      <div class="peoI-con"><img class="imgW100" src="img/infos-bg1.png" /></div>
      <div class="peoI-text">
        <div class="peoIt-name"><span class="nick"></span></div>
        <!-- <div class="peoIt-avatar"><img class="avatar" class="imgSize" /></div> -->
        <div class="peoIt-s1">感谢您！</div>
        <div class="peoIt-s2">点亮“善建星火”</div>
        <div class="peoIt-two">来自<span class="city"></span>地区 <br />第<span class="num">1</span>位</div>
        <div class="peoIt-s3">点亮“校友地图”的建规人</div>
        <div class="peoI-code"><img src="img/xh.png" /></div>
        <div class="peoIt-three pt20">建筑与规划学院</div>
        <div class="peoIt-three">期待您的消息</div>
        <div class="peoIt-four">扫描下面二维码关注建规院公众号</div>
        <div class="peoI-code"><img src="img/infos-code.png" /></div>
      </div>
      <!-- <div class="peoI-btn btnClick"><a
          href="weixin://mp.weixin.qq.com/mp/profile_ext?action=home&__biz=MzA3NjQ4MTY4OA=="><img class="imgW100" src="img/btn3.png" /></a></div> -->
      <div class="peoI-bg1"><img src="img/infos-bg2.png" /></div>
    </div>
    <div class="people-info weixin" style="display: none">
      <div class="peoI-con"><img class="imgW100" src="img/infos-bg1.png"></div>
      <div class="peoI-text">
        <!-- <div class="peoIt-name">@<span class="nick"></span></div> -->
        <!-- <div class="peoIt-avatar"><img class="imgSize avatar"></div> -->
        <div class="peoIt-s1">感谢您！</div>
        <div class="peoIt-s2">点亮“善建星火”</div>
        <div class="peoIt-two">来自<span class="city"></span>地区 <br>第<span class="num">1</span>位</div>
        <div class="peoIt-s3">点亮“校友地图”的建规人</div>
        <div class="peoI-code"><img src="img/xh.png" /></div>
        <div class="peoIt-three pt20">建筑与规划学院</div>
        <div class="peoIt-three">期待您的消息</div>
        <div class="peoIt-four">点击下方按钮填写校友问卷</div>
        <div class="peoI-btn btnClick"><a href="https://www.wjx.top/vm/wAqGzNL.aspx# "><img class="imgW100"
              src="img/infos-btn1.png"></a></div>
        <!-- <div class="peoI-code"><img src="img/infos-code.png"></div> -->
      </div>
      <!-- <div class="peoI-btn btns btnImgClick"><img class="imgW100" src="img/btn2.png"></a></div> -->
      <div class="peoI-bg1"><img src="img/infos-bg2.png"></div>
    </div>
    <div class="share-con" style="display: none">
      <img src="img/shareImg2.png" />
    </div>
  </div>

  <script type="text/javascript" src="js/jquery-2.1.4.js"></script>
  <script src="js/cityPickerModule.js"></script>
  <!-- 文字大小适应 -->
  <script type="text/javascript" src="js/public.js"></script>
  <!-- 选择城市--js -->
  <script type="text/javascript" src="js/jquery-weui.js" defer></script>
  <script type="text/javascript" src="js/city-picker.js" defer></script>
  <script src="js/jweixin-1.6.0.js"></script>
  <script src="js/html2canvas.min.js"></script>
  <script src="js/js.cookie.min.js"></script>
  <script src="js/vconsole.min.js"></script>
  <script>
    if (utils.getQueryString('debug')) {
      new VConsole();
    }
  </script>
  <script>

    if (utils.isWeixin()) {
      weixinShare({
        title: '来点亮安建大建规院校友地图！',
        desc: '点亮星辰大海，畅想美好未来。',
        link: window.location.href,
        imgUrl: 'img/kidbig.png'
      });
    }

  </script>
  <script>
    function getImgUrl(url) {
      return new Promise(function (resolve, reject) {
        var img = new Image();
        img.crossOrigin = 'Anonymous';
        img.src = url;
        var canvas2 = document.createElement('canvas');
        var ctx = canvas2.getContext('2d');
        img.onload = function () {
          canvas2.height = img.height;
          canvas2.width = img.width;
          ctx.drawImage(img, 0, 0);
          var dataURL2 = canvas2.toDataURL('image/png');
          resolve(dataURL2)
          canvas2 = null;
        }
      })
    }
  </script>

  <script type="text/javascript">
    var core = {
      //资源预加载
      loadResources: function () {
        var imgPath = "img/";
        var sourceArr = [
          'bg.png',
          'img/star-bg.gif',
          'img/icon01.gif',
          'icon-bg.png',
          'info-bg1.png',
          'text01.gif',
          'clickBtns.png',
          'info-bg2.png',
          'logo2.png',
          'text02.png',
          'start01.png',
          'text04.png',
          'animate001.gif',
          'infos-bg1.png',
          'infos-code.png',
          'infos-btn1.png',
          'infos-bg2.png',
          'shareImg2.png',
          'infos-bg1.png'
        ];
        for (var i = 0; i < sourceArr.length; i++) {
          if (sourceArr[i].indexOf('icon01.gif') < 0 && sourceArr[i].indexOf('star-bg.gif') < 0) {
            sourceArr[i] = (imgPath + sourceArr[i]);
          }
        }
        var loadImage = function (path, callback) {
          var img = new Image();
          img.onload = function () {
            img.onload = null;
            callback(path);
          }
          img.src = path;
        }
        var imgLoader = function (imgs, callback) {
          var len = imgs.length, i = 0;
          while (imgs.length) {
            loadImage(imgs.shift(), function (path) {
              callback(path, ++i, len);
            });
          }
        }

        imgLoader(sourceArr, function (path, curNum, total) {
          var percent = curNum / total;
          document.getElementById('progressText').innerHTML = Math.floor(percent * 100) + "%";
          document.getElementById('progressBar').style.width = Math.floor(percent * 100) + "%";
          if (percent == 1) {
            setTimeout(core.showPage, 300);
          }
        });
      }(),
      //资源加载完毕，显示页面内容
      showPage: function () {

        $('.loading-con').fadeOut();
        $('.main').fadeIn();
        setTimeout(function () {
          $('.star-bgs').fadeIn();
        }, 300);
        next()
      }
    }

    function next() {
      let currCityCode,
        currCityText;

      var city, num;

      //背景音乐开关
      $("#musicBgStatus").click(function () {
        var audioBgs = document.getElementById('audioBg');
        if (audioBgs.paused) {
          audioBgs.play();
          $(".bgIcon").removeClass('off').addClass('on');
        } else {
          audioBgs.pause();
          $(".bgIcon").removeClass('on').addClass('off');
        }

      })

      /* $("#city-picker").cityPicker({
        container: '#picker-container',
        onChange: function (p, v, dv) {
          
          currCityCode = v; // 'v' is the selected city's code
          currCityText = dv; // 'dv' is the selected city's text

          city = dv[1].replace(/(市|县|自治区|地区)/, ''); // Assumes city name is the second element
          $('.city').text(city);
        },
        onClose: function (p, v, d) {
          // Actions to take when the picker closes, if any
        }
      }); */

      let audioPlayC = document.getElementById('audioClick'); //点击音效
      
      $(document).ready(function() {
      // Initialize the city picker
      CityPickerModule.init();

      // Bind click event to the button for updating city count
      $('.cancelS').click(function() {
        // Get the current city code and text from the CityPickerModule
        var currCityCode = CityPickerModule.getCurrCityCode();
        var currCityText = CityPickerModule.getCurrCityText();

        if (currCityCode && currCityCode.length > 0) {
          currCityCode = currCityCode.join(',');
          currCityText = currCityText.join(',');

          var imgElem = $('.animate-two').find('img');
          if (currCityCode.split(',')[0] !== '0') {
            var code = currCityCode.split(',')[0];
            imgElem.attr('src', `https://n.sinaimg.cn/dfz/dtdh/province_${code}.gif`).show();
          } else {
            imgElem.remove();
          }

          $('.world-info').fadeOut();
          audioPlayC.play();

          setTimeout(function() {
            $('.gray-start').fadeIn();

            setTimeout(function() {
              $('.gray-start').addClass('bottom');
              $('.gray-start').fadeOut();
              $('.animate-one').fadeIn();
              let audioFly = document.getElementById('audioFly');
              audioFly.play();

              setTimeout(function() {
                $('.animate-one').fadeOut();
                $('.animate-two').fadeIn();

                setTimeout(function() {
                  $('.animate-three').fadeIn();

                  setTimeout(function() {
                    $('.animate-three').fadeOut();
                    $('.animate-end').fadeIn();

                    setTimeout(function() {
                      var className = utils.isWeixin() ? 'weixin' : 'weibo';
                      $(`.${className}`).fadeIn();
                      $(`.${className}`).addClass('on');
                    }, 1500);
a
                  }, 1700);

                }, 300);

              }, 1000);a

            }, 500);

          }, 300);
          
          CityPickerModule.updateCount();
        }
      });

      $(".shaP-close").click(function() {
        $(".share-popup").fadeOut();
      });
    });

      $('.wi-title').click(function () {
        $('.wi-city').addClass('on');
        $('.wi-more').addClass('on')
        audioPlayC.play();
      });

      // 选择地址取消
      $('.comfirmS').click(function () {
        $('.wi-city').removeClass('on');
        $('.wi-more').removeClass('on');
        audioPlayC.play();
      });

    }
  </script>

</body>

</html>
